Мониторинг CPU/Memory/HDD

----------------------------------

# ps 

# ps -eF – e посмотреть все процессы, F подробная иформация

UID – user name
PID – идентификатор процесса
PPID – идент. родительского процесса 
C – расходование ресурсов процесса в %
SZ – размер процесса
RSS – реальный размер процесса в памяти
PSR – ядро процесса, на ктором запущен процесс
STIME – время запуска процесса
TTY – терминал к которому привязан процесс, если привязан
TIME – общее время выполнения процесса
CMD – команда которой был запущен процесс, квадратн скобки если не читаются аргументы процесса

# ps -efH – древо

# ps -efL – просмотр списка процессов с потоками

LWP – LightWeightProccess – идентификатор потока
NLWP – количеств потоков процесса

# ps -fu user – u список процессов определенного user

----------------------------------

# vmstat

# watch vmstat – будет изменять показания каждые 2 секунды

# vmstat -s – расширенный режим

Вывод vmstat (top,htop):

procs--
r – running - среднее количество потоков ядра, исполняемых и ждущих исполнения. Если это число больше чем количество ядер – есть потоки которые ждут ядро.
b – bloked – это процессы находящиеся в стадии непрерывного сна, их нельзя убить, они чаще всего ждут ответа от дисков, иногда от системы распределения памяти. Но чаще всего это означает что диск медленный по различным причинам, и заставляет систему ждать.

-systems -- 
in -  interaps - количество сигналов прерываний в секунду, которые поступают от програмного обеспечения или аппаратного обеспечения, наступление какого либо события.
cs – contest switches – это преключения процессора с одной задачи на другую, при этом процессору нужно сохранить свое состояние для последующего восстановления и обработки процесса
us – user space – время используется для выполнения кода на уровне пользователя в непривелегированном режиме. Выполняется код софта котоый работает без доступа к железу 
sy – system – время использования софта на привелегированном уровне
id – idol – простой процессора
wa – wait – время ожидания ответа от диска. При увеличении значений смотреть на диск
st – stolen time – украденное время. Гипервизор (гибкое распределение ресурсов процессора) хорошо работает с дисками или озу, но сложнее с делением времени использования процессора между виртуальными машинами. Показывает как много виртуальная машина ожидает ответа от гипервизора

--memory--
swpd – cколько в swap. в жесткий диск в принципе много медленнее чем оперативная память, если что то часто свапится в раздел это проблема.  Необходима тонкая настройка в swapiness.
free – свободная
buff – buffer (heap) – страницы памяти зарезервированные системой для работы какого либо процесса. Кстати, стоит обратить внимание на этот параметр и второе название – одна из систем мониторинга в кубере работает на heap, и он присутствует в качестве части самого кубера.
cache – файлы которые недавно были использованы системой, процессами и сохранены в памяти на всякий случай, данные к которым часто нужен доступ приложений и потому они закэшированны в памяти

--swap-- 
si – swaped in - количество блоков в секунду которые система считывает в оперативную память. Размер блоков зависит от формата файловой системы и настроек
so – swaped out – количество блоков в секунду которое система записывает на диск.
По ключу -а будут показанны параметры 
active – объем памяти выделенной под процесс, работающий (активный) в настоящее время
inactive – обьем памяти выделенный под процесс, но этот процесс на это время более не активен.  Он точно так же является свободной оперативной памятью, но система пока продолжает его отслеживать. Именно эту память в идеале свопить.

--io--  жесткие диски
bi – сколько блоков в секунду считали с дисковой подсистемы 
bo – сколько блоков в секунду записали на дисковую подсистему

----------------------------------------

# top

PR – приоритет планировщика
NI – рекомендуемый приоритет планировщика, значение можно менять
VIRT – все, что находится в памяти, используется или зарезервировано для использования
RES – ResidentMemorySize – все что находится в памяти и относится к процессу
SHR – часть памяти RES с ресурсами совместного использования с другими процессами


load average – показания загрузки на последнюю минуту, пять минут, пятнадцать минут. Средняя загрузка в сумме по потокам
Средняя загрузка в 8 на восьмиядерной машине в среднем эквивалентна загрузке в 1 на одноядерной машине, но это не совсем так, ибо какая то часть ресурсов процессора будет уходить на распараллеливание потоков задач между ядрами

%Cpu (нажать ‘1’ - %Cpu0 : %Cpu1: и так далее) – загрузка Сpu
us – user space
sys – system space
ni – nice level – какая часть процессора занята процессами с измененными приоритетами
id -  idol
wa – wait (важно контролировать в метриках дисков)
hi – hardware interaps – аппаратные прерывания
si – software interaps – программные прерывания
st – stolen time -
%MEM – загрузка на основе RES 

По умолчанию top сортируется по %CPU
shift + >  или shift + <  - переключение сортировки по столбцам
shift + m – сортировка по памяти

‘S’ – состояние процесса:

R – run – ‘бежит’, запущен
S – sleep - спит
D – uninterruptible sleep – ожидает завершение операции 
T – trace – остановлен
t – остановлен отладчиком
Z – zombie – процесс, потерявщий родительский процесс

press ‘Z’ – top станет малость цветным
press Sh + V – древо процессов
press Sh + H – потоки
press Sh + F – выбрать дополнительные поля для отображения


---------------------------------

# htop (нет по умолчанию) – хипстерская штука, более наглядная, вся цветастая с функциональным меню. 

F2 – Display Options - 
---------------------------------

# stress 
# stress -c 1 – c это cpu, 1 – грузим одно ядро
# stress –vm 1 –vm-bytes 2048M 
--vm N – запускаем N рабочих выделяющих и занимающих память 
--vm-bytes N – выделить N байт для рабочего 

---------------------------------

# free – память 
-h – human – человекочитаемый вид

shared – память является общей для каких либо процессов, может использоваться приложениями без системных вызовов ядра. Монтируется в каталог ? 

В данных по памяти нет строгой арифметики так как одни и те же блоки памяти могут входить в несколько столбцов 

----------------------------------

# swapon -s – данные по swap

----------------------------------

# ionice – утилита для назначает приоритет потокам ввода.вывода

----------------------------------

# iotop – input/output/top (нужна установка) – метрики по устройствам ввода/вывода

total – пропускная способность между процессами и ядром к подсистеме ввода/вывода. Как работаем вообще (тут может учитываться процессы записи в cache)
current (Actual)– как подсистема ввода/вывода обращается непосредственно к железу. Это сколько реальнозаписывается и считывается с жесткого диска

TID – ThredID - ID потока. (PID – Process ID – ID процесса)

PRIO – priority

id – idol – может получить доступ к диску только когда роцессы не хотят к нему обращаться
be/n – best ed-ford – класс по умолчанию, n[0:7]
rt/n – real time – высокий приоритет, n[0:7]

----------------------------------

# iostat – (package sysstat) утилита вывод которой хорошо скриптуется, у некоторых систем мониторинга есть готовые профили для обработки вывода

tps – количество запросов в секунду 
kB_read/s ; kB_wrtn/s – прочитано.записано в секунду
kB_read ; kB_wrtn – прочитано/записано всего

# iostat -x
avg-cpu

rrqm/s ; wrqm/s – request – количество запросов на запись/чтение в секунду
r/s ; w/s – фактическое количество записано.прочитано
rkB/s ; wkB/s – записано/прочитано в секунду в КБ
avgrq … да ну нафиг, там здоровенный мануал где все расписано 

Вобщем клевая утилита, 

----------------------------------

# sar (огромный мануал) – счетчик производительности системы, умеет собирать инфу, сохранять, давать отчеты и т.д.

# sar T N1 – T это интервал, N это сколько делать запросов. По умолчанию без ключей выводит производительность CPU 

-----------------------------------

# atop – отображение потребления процессами ресурсов системы. Клевая штука, знакома с Docker
CID – идентификатор контейнера, Docker
SYSCPU – время потраченное процессом на выполнение в sysspace
USRCPU – то же в userspace
VGROW – увеличение использования памяти колонки VIRT за последний период
RGROW – то же но в колонке RSS
ST – статус процесса: N – новый; E – завершенный; S, C – завершен принудительно сигналом
EXC – код выхода или код сигнала, которым был завершен процесс
THR – общее количество потоков в процессе
S – состояние процесса – как в top
CPUNR – номер ядра процесса на котором запущен основной поток
CMD – COMMAND

press ‘y’ – отображение потоков процесса
press ‘m’ – просмотр памяти
press ‘g’ – вернуться

 
